<div class="category-modal">
  <div class="modal-header">
    <h2 class="text-primary font-medium">{{ isEditMode ? "Edit" : "Create" }} Category</h2>
  </div>

  <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()">
    <div class="modal-content">
      <div class="form-container">
        <mat-form-field appearance="fill">
          <mat-label>Category Name</mat-label>
          <input matInput formControlName="categoryName" required />
          <mat-error
            *ngIf="categoryForm.get('categoryName')?.hasError('required')"
          >
            Category name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Icon</mat-label>
          <input
            matInput
            formControlName="icon"
            placeholder="e.g., shopping_cart"
          />
          <mat-icon matSuffix class="icon-secondary">{{
            categoryForm.get("icon")?.value || "category"
          }}</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Required Licenses (comma separated)</mat-label>
          <input
            matInput
            formControlName="licensesRequired"
            placeholder="e.g., license_weapons, license_trade"
          />
        </mat-form-field>

        <div class="form-field">
          <mat-slide-toggle formControlName="isVisible" class="mat-primary">
            Visible
          </mat-slide-toggle>
        </div>

        <div class="product-list-section">
          <div class="section-title">
            <h3 class="text-primary font-medium">Products in Category</h3>
            <div class="action-buttons">
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="assignExistingProducts()"
                class="action-button"
              >
                <mat-icon>playlist_add</mat-icon>
                Assign Products
              </button>
              <button
                mat-raised-button
                color="primary"
                type="button"
                (click)="addProductToCategory()"
                class="action-button"
              >
                <mat-icon>add</mat-icon>
                Add Product
              </button>
            </div>
          </div>
          <div class="product-list-container scroll-y slim-scrollbar">
            <!-- Leere Zustands-Meldung -->
            <div *ngIf="categoryProducts.length === 0" class="empty-state">
              <p class="text-secondary">No products in this category.</p>
              <p class="text-secondary">Use the buttons above to add products.</p>
            </div>
            
            <!-- Produktliste nur anzeigen, wenn Produkte vorhanden sind -->
            <ng-container *ngIf="categoryProducts.length > 0">
              <app-product-list
                [products]="categoryProducts"
                [showActions]="true"
                (productRemoved)="onProductRemoved($event)"
                (productEdited)="onProductEdited($event)"
              >
              </app-product-list>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
      <button 
        mat-raised-button 
        color="primary" 
        type="submit"
        [disabled]="categoryForm.invalid">
        {{ isEditMode ? "Save" : "Create" }}
      </button>
    </div>
  </form>
</div>
