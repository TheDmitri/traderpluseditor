<div class="category-modal">
  <div class="modal-header">
    <h2>{{ isEditMode ? "Edit" : "Create" }} Category</h2>
  </div>

  <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()">
    <div class="modal-content">
      <div class="form-container">
        <mat-form-field appearance="fill">
          <mat-label>Category Name</mat-label>
          <input matInput formControlName="categoryName" required />
          <mat-error
            *ngIf="categoryForm.get('categoryName')?.hasError('required')"
          >
            Category name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Icon</mat-label>
          <input
            matInput
            formControlName="icon"
            placeholder="e.g., shopping_cart"
          />
          <mat-icon matSuffix>{{
            categoryForm.get("icon")?.value || "category"
          }}</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Required Licenses (comma separated)</mat-label>
          <input
            matInput
            formControlName="licensesRequired"
            placeholder="e.g., license_weapons, license_trade"
          />
        </mat-form-field>

        <mat-slide-toggle formControlName="isVisible">
          Visible
        </mat-slide-toggle>

        <!-- Add product list here -->
        <div class="product-list-section" (click)="$event.stopPropagation()">
          <div class="product-list-header">
            <h3>Products in Category</h3>
            <div class="header-buttons">
              <button
                mat-raised-button
                color="primary"
                (click)="$event.stopPropagation(); assignExistingProducts()"
                (mousedown)="$event.stopPropagation()"
              >
                <mat-icon>playlist_add</mat-icon>
                Assign Products
              </button>
              <button
                mat-raised-button
                color="primary"
                (click)="$event.stopPropagation(); addProductToCategory()"
                (mousedown)="$event.stopPropagation()"
              >
                <mat-icon>add</mat-icon>
                Add Product
              </button>
            </div>
          </div>
          <app-product-list
            [products]="categoryProducts"
            [showActions]="true"
            (productRemoved)="onProductRemoved($event)"
            (productEdited)="onProductEdited($event)"
          >
          </app-product-list>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
      <button mat-raised-button color="primary" type="submit"
        [disabled]="categoryForm.invalid">
        {{ isEditMode ? "Save" : "Create" }}
      </button>
    </div>
  </form>
</div>
